<div class="dialog-overlay" (click)="$event.stopPropagation()">
  <!-- Background Decorations -->
  <div class="floating-orbs">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
    <div class="orb orb-4"></div>
  </div>

  <!-- Main Dialog Container -->
  <div class="dialog-container">
    <!-- Header Section -->
    <div class="dialog-header">
      <div class="role-icon-container">
        <i class="fas {{ roleIcon }} role-icon"></i>
      </div>
      <h2 class="dialog-title">Change Password</h2>
      <p class="dialog-subtitle">Ensure your account stays secure</p>
      <div class="user-info">
        <span class="username">{{ data.username }}</span>
        <span class="user-role">{{ data.role | titlecase }}</span>
      </div>
    </div>

    <!-- Form Section -->
    <form [formGroup]="passwordForm" class="password-form" (ngSubmit)="onChangePassword()">
      <!-- Current Password -->
      <div class="form-group">
        <label for="currentPassword" class="form-label">
          <i class="fas fa-lock input-icon"></i>
          Current Password
        </label>
        <div class="input-container">
          <input
            id="currentPassword"
            [type]="showCurrentPassword ? 'text' : 'password'"
            formControlName="currentPassword"
            class="form-input"
            placeholder="Enter your current password"
            autocomplete="current-password"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility('current')"
          >
            <i class="fas" [class.fa-eye]="!showCurrentPassword" [class.fa-eye-slash]="showCurrentPassword"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
          Current password is required
        </div>
      </div>

      <!-- New Password -->
      <div class="form-group">
        <label for="newPassword" class="form-label">
          <i class="fas fa-key input-icon"></i>
          New Password
        </label>
        <div class="input-container">
          <input
            id="newPassword"
            [type]="showNewPassword ? 'text' : 'password'"
            formControlName="newPassword"
            class="form-input"
            placeholder="Enter your new password"
            autocomplete="new-password"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility('new')"
          >
            <i class="fas" [class.fa-eye]="!showNewPassword" [class.fa-eye-slash]="showNewPassword"></i>
          </button>
        </div>
        
        <!-- Password Strength Indicator -->
        <div class="password-strength" *ngIf="passwordForm.get('newPassword')?.value">
          <div class="strength-bar">
            <div class="strength-progress" [style.width.%]="passwordStrength.percentage" [style.background-color]="passwordStrength.color"></div>
          </div>
          <span class="strength-label" [style.color]="passwordStrength.color">{{ passwordStrength.label }}</span>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements" *ngIf="passwordForm.get('newPassword')?.value">
          <div class="requirement" [class.met]="passwordForm.get('newPassword')?.value?.length >= 8">
            <i class="fas fa-check"></i> At least 8 characters
          </div>
          <div class="requirement" [class.met]="hasUppercase(passwordForm.get('newPassword')?.value)">
            <i class="fas fa-check"></i> One uppercase letter
          </div>
          <div class="requirement" [class.met]="hasNumber(passwordForm.get('newPassword')?.value)">
            <i class="fas fa-check"></i> One number
          </div>
        </div>

        <div class="error-message" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
          <span *ngIf="passwordForm.get('newPassword')?.errors?.['required']">New password is required</span>
          <span *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Password must be at least 8 characters</span>
          <span *ngIf="passwordForm.get('newPassword')?.errors?.['passwordRequirements']">Password must contain uppercase letter and number</span>
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <label for="confirmPassword" class="form-label">
          <i class="fas fa-check-circle input-icon"></i>
          Confirm New Password
        </label>
        <div class="input-container">
          <input
            id="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            formControlName="confirmPassword"
            class="form-input"
            placeholder="Confirm your new password"
            autocomplete="new-password"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility('confirm')"
          >
            <i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
          Please confirm your password
        </div>
        <div class="error-message" *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched">
          Passwords do not match
        </div>
        <div class="error-message" *ngIf="passwordForm.errors?.['samePassword'] && passwordForm.get('confirmPassword')?.touched">
          New password must be different from current password
        </div>
      </div>

      <!-- Success/Error Messages -->
      <div class="message-container" *ngIf="successMessage || errorMessage">
        <div class="success-message" *ngIf="successMessage">
          <i class="fas fa-check-circle"></i>
          {{ successMessage }}
        </div>
        <div class="error-message" *ngIf="errorMessage">
          <i class="fas fa-exclamation-circle"></i>
          {{ errorMessage }}
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="button-container">
        <button
          type="button"
          class="btn btn-cancel"
          (click)="onCancel()"
          [disabled]="isLoading"
        >
          <i class="fas fa-times"></i>
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!isFormValid || isLoading"
        >
          <div class="btn-content">
            <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
            <i class="fas fa-lock" *ngIf="!isLoading"></i>
            {{ isLoading ? 'Changing...' : 'Change Password' }}
          </div>
        </button>
      </div>
    </form>
  </div>
</div>