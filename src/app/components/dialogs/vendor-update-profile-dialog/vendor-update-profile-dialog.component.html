<div class="modal-overlay" (click)="closeDialog()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <h2 class="dialog-title">
        <i class="fas fa-store"></i>
        Update Vendor Profile
      </h2>
      <button type="button" class="close-btn" (click)="closeDialog()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <form #profileForm="ngForm" class="update-profile-form" (ngSubmit)="submitForm(profileForm)">
        
        <!-- Profile Picture Section -->
        <div class="profile-pic-section">
          <div class="profile-pic-container">
            <img 
              [src]="vendor.profilePicUrl || 'https://cdn.pixabay.com/photo/2023/02/18/11/00/icon-7797704_640.png'" 
              alt="Profile Picture"
              class="profile-preview"
            />
            <div class="upload-overlay">
              <input 
                type="file" 
                id="vendorProfilePic" 
                (change)="uploadProfilePic($event)" 
                accept="image/*"
                style="display: none;"
              />
              <label for="vendorProfilePic" class="upload-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M3 17l6-6 4 4 8-8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M14 7h7v7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Change Photo
              </label>
            </div>
          </div>
          <p class="profile-name">{{ vendor.shoppeeName || 'Shop Name' }}</p>
        </div>

        <!-- Form Fields Grid -->
        <div class="form-grid">
          
          <!-- Shop Name -->
          <div class="form-row">
            <label for="shoppeeName">Shop Name <span class="required">*</span></label>
            <input 
              type="text" 
              id="shoppeeName"
              name="shoppeeName"
              [(ngModel)]="vendor.shoppeeName" 
              required
              #shoppeeNameField="ngModel"
              placeholder="Enter shop name"
              [class.error]="shoppeeNameField.invalid && shoppeeNameField.touched"
            />
            <span class="error-message" *ngIf="shoppeeNameField.invalid && shoppeeNameField.touched">
              Shop name is required
            </span>
          </div>

          <!-- Shopkeeper Name -->
          <div class="form-row">
            <label for="shopkeeperName">Shopkeeper Name <span class="required">*</span></label>
            <input 
              type="text" 
              id="shopkeeperName"
              name="shopkeeperName"
              [(ngModel)]="vendor.shopkeeperName" 
              required
              #shopkeeperNameField="ngModel"
              placeholder="Enter shopkeeper name"
              [class.error]="shopkeeperNameField.invalid && shopkeeperNameField.touched"
            />
            <span class="error-message" *ngIf="shopkeeperNameField.invalid && shopkeeperNameField.touched">
              Shopkeeper name is required
            </span>
          </div>

          <!-- Email Address -->
          <div class="form-row">
            <label for="email">Email Address</label>
            <input 
              type="email" 
              id="email"
              name="email"
              [(ngModel)]="vendor.email" 
              readonly
              class="readonly-field"
            />
            <span class="field-note">Email cannot be changed</span>
          </div>

          <!-- Mobile Number -->
          <div class="form-row">
            <label for="mobile">Mobile Number <span class="required">*</span></label>
            <input 
              type="tel" 
              id="mobile"
              name="mobile"
              [(ngModel)]="vendor.mobile" 
              maxlength="10"
              pattern="[0-9]{10}"
              required
              #mobileField="ngModel"
              placeholder="Enter 10-digit mobile number"
              [class.error]="mobileField.invalid && mobileField.touched"
              (input)="onMobileInput($event)"
            />
            <span class="error-message" *ngIf="mobileField.invalid && mobileField.touched">
              Please enter a valid 10-digit mobile number
            </span>
          </div>

          <!-- Business Name -->
          <div class="form-row">
            <label for="businessName">Business Name</label>
            <input 
              type="text" 
              id="businessName"
              name="businessName"
              [(ngModel)]="vendor.businessName"
              placeholder="Enter business name"
            />
          </div>

          <!-- Business Registry Number -->
          <div class="form-row">
            <label for="businessRegistryNumber">Business Registry Number</label>
            <input 
              type="text" 
              id="businessRegistryNumber"
              name="businessRegistryNumber"
              [(ngModel)]="vendor.businessRegistryNumber"
              readonly
              class="readonly-field"
            />
            <span class="field-note">Registry number cannot be changed</span>
          </div>

          <!-- Shop Address -->
          <div class="form-row full-width">
            <label for="shoppeeAddress">Shop Address <span class="required">*</span></label>
            <textarea 
              id="shoppeeAddress"
              name="shoppeeAddress"
              [(ngModel)]="vendor.shoppeeAddress" 
              required
              #addressField="ngModel"
              placeholder="Enter complete shop address"
              rows="3"
              [class.error]="addressField.invalid && addressField.touched"
            ></textarea>
            <span class="error-message" *ngIf="addressField.invalid && addressField.touched">
              Shop address is required
            </span>
          </div>

          <!-- State -->
          <div class="form-row">
            <label for="locationState">State <span class="required">*</span></label>
            <select 
              id="locationState"
              name="locationState"
              [(ngModel)]="vendor.locationState"
              required
              #stateField="ngModel"
              (change)="onStateChange()"
              [class.error]="stateField.invalid && stateField.touched"
            >
              <option value="">Select State</option>
              <option *ngFor="let state of states" [value]="state.code">{{ state.name }}</option>
            </select>
            <span class="error-message" *ngIf="stateField.invalid && stateField.touched">
              Please select a state
            </span>
          </div>

          <!-- District -->
          <div class="form-row">
            <label for="locationDistrict">District <span class="required">*</span></label>
            <select 
              id="locationDistrict"
              name="locationDistrict"
              [(ngModel)]="vendor.locationDistrict"
              required
              #districtField="ngModel"
              [disabled]="!vendor.locationState"
              [class.error]="districtField.invalid && districtField.touched"
            >
              <option value="">{{ vendor.locationState ? 'Select District' : 'Select State First' }}</option>
              <option *ngFor="let district of filteredDistricts" [value]="district">{{ district }}</option>
            </select>
            <span class="error-message" *ngIf="districtField.invalid && districtField.touched">
              Please select a district
            </span>
          </div>

          <!-- Return Policy -->
          <div class="form-row full-width">
            <label for="returnPolicy">Return Policy</label>
            <textarea 
              id="returnPolicy"
              name="returnPolicy"
              [(ngModel)]="vendor.returnPolicy"
              placeholder="Enter your return policy details"
              rows="3"
            ></textarea>
          </div>

        </div>

        <!-- Form Footer -->
        <div class="form-footer">
          <button type="button" class="cancel-btn" (click)="closeDialog()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="save-btn"
            [disabled]="profileForm.invalid || isSubmitting"
          >
            <span *ngIf="isSubmitting" class="loading-spinner"></span>
            {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
