<div class="settings-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1><i class="fas fa-cog"></i> Account Settings</h1>
      <p>Manage your profile, security, and preferences</p>
    </div>
  </div>

  <div class="settings-container">
    <!-- Sidebar Navigation -->
    <aside class="settings-sidebar">
      <nav class="settings-nav">
        <button 
          *ngFor="let tab of tabs"
          [class.active]="activeTab === tab.id"
          [class.danger]="tab.id === 'danger-zone'"
          (click)="setActiveTab(tab.id)">
          <i class="fas {{ tab.icon }}"></i>
          <span>{{ tab.label }}</span>
        </button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="settings-content">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading your settings...</p>
      </div>

      <!-- Profile Tab -->
      <section *ngIf="activeTab === 'profile' && !isLoading" class="settings-section">
        <div class="section-header">
          <h2>Profile Information</h2>
          <p>Update your personal details and profile picture</p>
        </div>

        <div class="profile-content">
          <!-- Profile Image -->
          <div class="profile-image-section">
            <div class="avatar-wrapper">
              <img 
                *ngIf="profileImageUrl" 
                [src]="profileImageUrl" 
                alt="Profile" 
                class="avatar-image">
              <div *ngIf="!profileImageUrl" class="avatar-placeholder">
                <i class="fas fa-user"></i>
              </div>
              <label class="avatar-upload" [class.uploading]="isUploadingImage">
                <input type="file" accept="image/*" (change)="onProfileImageChange($event)" hidden>
                <i *ngIf="!isUploadingImage" class="fas fa-camera"></i>
                <i *ngIf="isUploadingImage" class="fas fa-spinner fa-spin"></i>
              </label>
            </div>
            <p class="avatar-hint">Click to upload a new photo (max 5MB)</p>
          </div>

          <!-- Profile Form -->
          <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="settings-form">
            <div class="form-row">
              <div class="form-group">
                <label for="fullName">Full Name *</label>
                <input 
                  type="text" 
                  id="fullName" 
                  formControlName="fullName" 
                  placeholder="Enter your full name">
                <span class="error" *ngIf="profileForm.get('fullName')?.touched && profileForm.get('fullName')?.errors?.['required']">
                  Name is required
                </span>
              </div>

              <div class="form-group">
                <label for="email">Email Address *</label>
                <input 
                  type="email" 
                  id="email" 
                  formControlName="email" 
                  placeholder="Enter your email">
                <span class="error" *ngIf="profileForm.get('email')?.touched && profileForm.get('email')?.errors?.['email']">
                  Please enter a valid email
                </span>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="phone">Phone Number *</label>
                <div class="phone-input">
                  <span class="country-code">+91</span>
                  <input 
                    type="tel" 
                    id="phone" 
                    formControlName="phone" 
                    placeholder="10-digit mobile number">
                </div>
                <span class="error" *ngIf="profileForm.get('phone')?.touched && profileForm.get('phone')?.errors?.['pattern']">
                  Enter a valid 10-digit mobile number
                </span>
              </div>

              <div class="form-group">
                <label for="dateOfBirth">Date of Birth</label>
                <input 
                  type="date" 
                  id="dateOfBirth" 
                  formControlName="dateOfBirth">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="gender">Gender</label>
                <select id="gender" formControlName="gender">
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                  <option value="prefer-not">Prefer not to say</option>
                </select>
              </div>
            </div>

            <div class="form-group full-width">
              <label for="bio">Bio</label>
              <textarea 
                id="bio" 
                formControlName="bio" 
                rows="3"
                placeholder="Tell us a bit about yourself..."
                maxlength="500"></textarea>
              <span class="char-count">{{ profileForm.get('bio')?.value?.length || 0 }}/500</span>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-primary" [disabled]="isSaving">
                <i *ngIf="isSaving" class="fas fa-spinner fa-spin"></i>
                {{ isSaving ? 'Saving...' : 'Save Changes' }}
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- Security Tab -->
      <section *ngIf="activeTab === 'security'" class="settings-section">
        <div class="section-header">
          <h2>Security Settings</h2>
          <p>Manage your password and account security</p>
        </div>

        <!-- Password Change -->
        <div class="security-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-key"></i>
            </div>
            <div class="card-title">
              <h3>Change Password</h3>
              <p>Update your password regularly to keep your account secure</p>
            </div>
          </div>
          
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="password-form">
            <div class="form-group">
              <label for="currentPassword">Current Password</label>
              <input 
                type="password" 
                id="currentPassword" 
                formControlName="currentPassword"
                placeholder="Enter current password">
            </div>

            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input 
                type="password" 
                id="newPassword" 
                formControlName="newPassword"
                placeholder="Enter new password">
              <div class="password-strength" *ngIf="passwordForm.get('newPassword')?.value">
                <div class="strength-bar">
                  <div 
                    class="strength-fill {{ getPasswordStrength().class }}"
                    [style.width.%]="getPasswordStrength().percentage">
                  </div>
                </div>
                <span class="strength-text {{ getPasswordStrength().class }}">
                  {{ getPasswordStrength().strength }}
                </span>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm New Password</label>
              <input 
                type="password" 
                id="confirmPassword" 
                formControlName="confirmPassword"
                placeholder="Confirm new password">
              <span class="error" *ngIf="passwordForm.get('confirmPassword')?.touched && passwordForm.get('confirmPassword')?.errors?.['mismatch']">
                Passwords do not match
              </span>
            </div>

            <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid || isSaving">
              <i *ngIf="isSaving" class="fas fa-spinner fa-spin"></i>
              {{ isSaving ? 'Updating...' : 'Update Password' }}
            </button>
          </form>
        </div>

        <!-- Two-Factor Authentication -->
        <div class="security-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <div class="card-title">
              <h3>Two-Factor Authentication</h3>
              <p>Add an extra layer of security to your account</p>
            </div>
            <label class="toggle-switch">
              <input 
                type="checkbox" 
                [checked]="twoFactorEnabled" 
                (change)="toggleTwoFactor()">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div *ngIf="showTwoFactorSetup" class="two-factor-setup">
            <div class="setup-options">
              <label class="radio-option" [class.selected]="twoFactorMethod === 'authenticator'">
                <input 
                  type="radio" 
                  name="2faMethod" 
                  value="authenticator"
                  [(ngModel)]="twoFactorMethod">
                <i class="fas fa-mobile-alt"></i>
                <span>Authenticator App</span>
              </label>
              <label class="radio-option" [class.selected]="twoFactorMethod === 'sms'">
                <input 
                  type="radio" 
                  name="2faMethod" 
                  value="sms"
                  [(ngModel)]="twoFactorMethod">
                <i class="fas fa-sms"></i>
                <span>SMS</span>
              </label>
            </div>
            <div class="setup-actions">
              <button class="btn-secondary" (click)="cancelTwoFactorSetup()">Cancel</button>
              <button class="btn-primary" (click)="setupTwoFactor()">Enable 2FA</button>
            </div>
          </div>

          <div *ngIf="twoFactorEnabled" class="two-factor-status">
            <i class="fas fa-check-circle text-success"></i>
            <span>Two-factor authentication is enabled</span>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="security-card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-history"></i>
            </div>
            <div class="card-title">
              <h3>Recent Activity</h3>
              <p>Review recent logins and security events</p>
            </div>
          </div>

          <div class="activity-list">
            <div *ngFor="let log of securityLogs" class="activity-item">
              <div class="activity-icon">
                <i class="fas" [ngClass]="{
                  'fa-sign-in-alt': log.action === 'Login',
                  'fa-key': log.action === 'Password Changed',
                  'fa-shield-alt': log.action.includes('2FA')
                }"></i>
              </div>
              <div class="activity-details">
                <strong>{{ log.action }}</strong>
                <span>{{ log.device }} • {{ log.location }}</span>
                <small>{{ log.date | date:'medium' }} • IP: {{ log.ip }}</small>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Notifications Tab -->
      <section *ngIf="activeTab === 'notifications'" class="settings-section">
        <div class="section-header">
          <h2>Notification Preferences</h2>
          <p>Choose how and when you want to be notified</p>
        </div>

        <div class="notification-channels">
          <div class="channel-header">
            <span class="channel-label">Notification Type</span>
            <div class="channel-options">
              <span><i class="fas fa-envelope"></i> Email</span>
              <span><i class="fas fa-bell"></i> Push</span>
              <span><i class="fas fa-sms"></i> SMS</span>
            </div>
          </div>

          <div *ngFor="let setting of notificationSettings" class="notification-row">
            <div class="notification-info">
              <strong>{{ setting.label }}</strong>
              <p>{{ setting.description }}</p>
            </div>
            <div class="notification-toggles">
              <label class="toggle-switch">
                <input 
                  type="checkbox" 
                  [checked]="setting.email" 
                  (change)="toggleNotification(setting, 'email')">
                <span class="toggle-slider small"></span>
              </label>
              <label class="toggle-switch">
                <input 
                  type="checkbox" 
                  [checked]="setting.push" 
                  (change)="toggleNotification(setting, 'push')">
                <span class="toggle-slider small"></span>
              </label>
              <label class="toggle-switch">
                <input 
                  type="checkbox" 
                  [checked]="setting.sms" 
                  (change)="toggleNotification(setting, 'sms')">
                <span class="toggle-slider small"></span>
              </label>
            </div>
          </div>
        </div>
      </section>

      <!-- Addresses Tab -->
      <section *ngIf="activeTab === 'addresses'" class="settings-section">
        <div class="section-header">
          <h2>Saved Addresses</h2>
          <p>Manage your delivery addresses</p>
          <button class="btn-primary" (click)="startAddAddress()" *ngIf="!isAddingAddress">
            <i class="fas fa-plus"></i> Add New Address
          </button>
        </div>

        <!-- Address Form -->
        <div *ngIf="isAddingAddress" class="address-form-card">
          <h3>{{ editingAddressId ? 'Edit Address' : 'Add New Address' }}</h3>
          <form [formGroup]="addressForm" (ngSubmit)="saveAddress()">
            <div class="form-row">
              <div class="form-group">
                <label>Address Label</label>
                <select formControlName="label">
                  <option value="Home">Home</option>
                  <option value="Work">Work</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Full Name</label>
                <input type="text" formControlName="fullName" placeholder="Recipient's name">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Phone Number</label>
                <div class="phone-input">
                  <span class="country-code">+91</span>
                  <input type="tel" formControlName="phone" placeholder="10-digit number">
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <label>Address Line 1</label>
              <input type="text" formControlName="addressLine1" placeholder="House/Flat No., Building Name">
            </div>

            <div class="form-group full-width">
              <label>Address Line 2</label>
              <input type="text" formControlName="addressLine2" placeholder="Street, Landmark">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>City</label>
                <input type="text" formControlName="city" placeholder="City">
              </div>
              <div class="form-group">
                <label>State</label>
                <select formControlName="state">
                  <option value="">Select State</option>
                  <option *ngFor="let state of states" [value]="state">{{ state }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>PIN Code</label>
                <input type="text" formControlName="pincode" placeholder="6-digit PIN">
              </div>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="isDefault">
                <span>Set as default address</span>
              </label>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="cancelAddressForm()">Cancel</button>
              <button type="submit" class="btn-primary">{{ editingAddressId ? 'Update' : 'Save' }} Address</button>
            </div>
          </form>
        </div>

        <!-- Address List -->
        <div class="address-grid" *ngIf="!isAddingAddress">
          <div *ngFor="let address of savedAddresses" class="address-card" [class.default]="address.isDefault">
            <div class="address-label">
              <i class="fas" [ngClass]="{
                'fa-home': address.label === 'Home',
                'fa-building': address.label === 'Work',
                'fa-map-marker-alt': address.label === 'Other'
              }"></i>
              <span>{{ address.label }}</span>
              <span *ngIf="address.isDefault" class="default-badge">Default</span>
            </div>
            <div class="address-details">
              <strong>{{ address.fullName }}</strong>
              <p>{{ address.addressLine1 }}</p>
              <p *ngIf="address.addressLine2">{{ address.addressLine2 }}</p>
              <p>{{ address.city }}, {{ address.state }} - {{ address.pincode }}</p>
              <p class="phone"><i class="fas fa-phone"></i> +91 {{ address.phone }}</p>
            </div>
            <div class="address-actions">
              <button class="btn-icon" (click)="editAddress(address)" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-icon" (click)="setDefaultAddress(address.id)" *ngIf="!address.isDefault" title="Set as default">
                <i class="fas fa-check-circle"></i>
              </button>
              <button class="btn-icon danger" (click)="deleteAddress(address.id)" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div *ngIf="savedAddresses.length === 0" class="empty-state">
            <i class="fas fa-map-marker-alt"></i>
            <p>No addresses saved yet</p>
            <button class="btn-primary" (click)="startAddAddress()">Add Your First Address</button>
          </div>
        </div>
      </section>

      <!-- Linked Accounts Tab -->
      <section *ngIf="activeTab === 'linked-accounts'" class="settings-section">
        <div class="section-header">
          <h2>Linked Accounts</h2>
          <p>Connect third-party accounts for easier sign-in</p>
        </div>

        <div class="linked-accounts-list">
          <div *ngFor="let account of linkedAccounts" class="linked-account-card">
            <div class="account-info">
              <div class="account-icon {{ account.provider.toLowerCase() }}">
                <i class="fab {{ account.icon }}"></i>
              </div>
              <div class="account-details">
                <strong>{{ account.provider }}</strong>
                <span *ngIf="account.connected">{{ account.email }}</span>
                <span *ngIf="!account.connected" class="not-connected">Not connected</span>
              </div>
            </div>
            <button 
              *ngIf="!account.connected" 
              class="btn-outline" 
              (click)="connectAccount(account)">
              Connect
            </button>
            <button 
              *ngIf="account.connected" 
              class="btn-danger-outline" 
              (click)="disconnectAccount(account)">
              Disconnect
            </button>
          </div>
        </div>
      </section>

      <!-- Privacy Tab -->
      <section *ngIf="activeTab === 'privacy'" class="settings-section">
        <div class="section-header">
          <h2>Privacy Settings</h2>
          <p>Control your privacy and data sharing preferences</p>
        </div>

        <div class="privacy-settings">
          <div class="privacy-item">
            <div class="privacy-info">
              <strong>Profile Visibility</strong>
              <p>Choose who can see your profile information</p>
            </div>
            <select [(ngModel)]="privacySettings.profileVisibility" (change)="savePrivacySettings()">
              <option value="public">Public</option>
              <option value="private">Private</option>
              <option value="friends">Registered Users Only</option>
            </select>
          </div>

          <div class="privacy-item">
            <div class="privacy-info">
              <strong>Show Purchase History</strong>
              <p>Allow others to see what you've purchased</p>
            </div>
            <label class="toggle-switch">
              <input 
                type="checkbox" 
                [(ngModel)]="privacySettings.showPurchaseHistory" 
                (change)="savePrivacySettings()">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="privacy-item">
            <div class="privacy-info">
              <strong>Show Wishlist</strong>
              <p>Make your wishlist visible to others</p>
            </div>
            <label class="toggle-switch">
              <input 
                type="checkbox" 
                [(ngModel)]="privacySettings.showWishlist" 
                (change)="savePrivacySettings()">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="privacy-item">
            <div class="privacy-info">
              <strong>Data Analytics</strong>
              <p>Help us improve by allowing anonymous usage analytics</p>
            </div>
            <label class="toggle-switch">
              <input 
                type="checkbox" 
                [(ngModel)]="privacySettings.allowDataAnalytics" 
                (change)="savePrivacySettings()">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="privacy-item">
            <div class="privacy-info">
              <strong>Personalized Ads</strong>
              <p>See ads based on your browsing and purchase history</p>
            </div>
            <label class="toggle-switch">
              <input 
                type="checkbox" 
                [(ngModel)]="privacySettings.personalizedAds" 
                (change)="savePrivacySettings()">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </section>

      <!-- Danger Zone Tab -->
      <section *ngIf="activeTab === 'danger-zone'" class="settings-section danger-zone">
        <div class="section-header">
          <h2><i class="fas fa-exclamation-triangle"></i> Danger Zone</h2>
          <p>Irreversible and destructive actions</p>
        </div>

        <div class="danger-actions">
          <div class="danger-card">
            <div class="danger-info">
              <strong>Download Your Data</strong>
              <p>Get a copy of all your data including orders, reviews, and account information</p>
            </div>
            <button class="btn-outline" (click)="downloadData()">
              <i class="fas fa-download"></i> Download Data
            </button>
          </div>

          <div class="danger-card">
            <div class="danger-info">
              <strong>Deactivate Account</strong>
              <p>Temporarily disable your account. You can reactivate anytime by logging in.</p>
            </div>
            <button class="btn-warning" (click)="deactivateAccount()">
              <i class="fas fa-pause-circle"></i> Deactivate
            </button>
          </div>

          <div class="danger-card critical">
            <div class="danger-info">
              <strong>Delete Account Permanently</strong>
              <p>Permanently delete your account and all associated data. This cannot be undone.</p>
            </div>
            <button class="btn-danger" (click)="deleteAccount()">
              <i class="fas fa-trash-alt"></i> Delete Account
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
